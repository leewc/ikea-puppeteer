'use strict';

/**
 * This is the script initially generated by Headless Recorder.
 */
const puppeteer = require('puppeteer');
(async () => {
  // debug mode
  const browser = await puppeteer.launch({headless: false, slowMo: 100})
  // const browser = await puppeteer.launch()
  const page = await browser.newPage()
  
  //lol debug
  page.on('console', msg => console.log('Console Log:', msg.text()));
  // await page.evaluate(() => console.log(`url is ${location.href}`));

  const navigationPromise = page.waitForNavigation()
  
  await page.goto('https://www.ikea.com/us/en/p/lidhult-sleeper-sofa-with-chaise-gassebol-light-beige-s79266092/')
  
  await page.setViewport({ width: 800, height: 600 })
  
  await page.waitForSelector('.js-buy-module > .range-revamp-buy-module__buttons > .range-revamp-buy-module__buttons--left > .range-revamp-btn > .range-revamp-btn__inner')
  await page.click('.js-buy-module > .range-revamp-buy-module__buttons > .range-revamp-buy-module__buttons--left > .range-revamp-btn > .range-revamp-btn__inner')
  
  await page.waitForSelector('.rec-modal > .rec-modal__content > .rec-modal__hero > .rec-added-to-cart__hero > .rec-text')
  await page.click('.rec-modal > .rec-modal__content > .rec-modal__hero > .rec-added-to-cart__hero > .rec-text')
  
  await navigationPromise
  
  await page.waitForSelector('.shoppingbag__headline > .checkout__wrapper > .checkout > .cart-ingka-btn > .cart-ingka-btn__inner')
  await page.click('.shoppingbag__headline > .checkout__wrapper > .checkout > .cart-ingka-btn > .cart-ingka-btn__inner')
  
  await navigationPromise
  
  await page.waitForSelector('.zipin #zipcode')
  await page.click('.zipin #zipcode')
  
  await page.type('.zipin #zipcode', '98109')
  
  await page.waitForSelector('.zipin > form > .\_Rfx6_ > .button > .button__text')
  await page.click('.zipin > form > .\_Rfx6_ > .button > .button__text')
  
  // if Toastify
  await page.waitForSelector('.Toastify__toast-container > .Toastify__toast--error > .button')
  await page.click('.Toastify__toast-container > .Toastify__toast > .button')
  
  // await browser.close()
})()


// https://ordercapture.ingka.com/ordercaptureapi/us/checkouts/4ea13d62-bb43-4e66-920b-3ef966b31828/delivery-areas/d9e0aceb-fd58-4dbe-b323-a3c9a691a0fc/delivery-services

// Item is in the cart

// const puppeteer = require('puppeteer');
// (async () => {
//   const browser = await puppeteer.launch()
//   const page = await browser.newPage()
  
//   await page.goto('https://www.ikea.com/us/en/order/delivery/')
  
//   await page.setViewport({ width: 1485, height: 921 })
  
//   await page.waitForSelector('.zipin #zipcode')
//   await page.click('.zipin #zipcode')
  
//   await page.type('.zipin #zipcode', '98109')
  
//   await page.waitForSelector('.zipin > form > .\_Rfx6_ > .button > .button__text')
//   await page.click('.zipin > form > .\_Rfx6_ > .button > .button__text')
  
//   await browser.close()
// })()

 
// await page.waitForSelector('.homedelivery #REGULAR')
// await page.click('.homedelivery #REGULAR')

// await page.waitForSelector('#flow-start > .checkout-section-sleeve > .inline-message > div > .inline-message__text')
// await page.click('#flow-start > .checkout-section-sleeve > .inline-message > div > .inline-message__text')

// await page.waitForSelector('.deliveryarrangements > .deliveryarrangement > .calendar > #calendar__toggle-54815 > .button__text')
// await page.click('.deliveryarrangements > .deliveryarrangement > .calendar > #calendar__toggle-54815 > .button__text')

// await page.waitForSelector('.deliveryarrangements > .deliveryarrangement > .calendar > #calendar__toggle-54815 > .button__text')
// await page.click('.deliveryarrangements > .deliveryarrangement > .calendar > #calendar__toggle-54815 > .button__text')

// await page.waitForSelector('.homedelivery #REGULAR')
// await page.click('.homedelivery #REGULAR')

// await page.waitForSelector('#flow-start > .checkout-section-sleeve > .delivery__submit > .button > .button__text')
// await page.click('#flow-start > .checkout-section-sleeve > .delivery__submit > .button > .button__text')
